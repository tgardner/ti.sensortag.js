!function(a,b){"use strict";var c="00002902-0000-1000-8000-00805f9b34fb",d=function(a){this.device=a,this.Accelerometer=new d.Accelerometer(this),this.IRTemperature=new d.IRTemperature(this),this.Humidity=new d.Humidity(this),this.Magnetometer=new d.Magnetometer(this),this.BarometricPressure=new d.BarometricPressure(this),this.Gyroscope=new d.Gyroscope(this),this.SimpleKey=new d.SimpleKey(this)};d.prototype.log=function(a){console.log("SensorTag #"+this.device+" "+a)},d.prototype.discover=function(a,c){var e,f,g=this,h=[];g.log("Discovering Services"),e=function(c){for(var e in c){var f=c[e];switch(f.uuid){case d.Accelerometer.UUID_SERVICE:g.Accelerometer.init(f);break;case d.IRTemperature.UUID_SERVICE:g.IRTemperature.init(f);break;case d.Humidity.UUID_SERVICE:g.Humidity.init(f);break;case d.Magnetometer.UUID_SERVICE:g.Magnetometer.init(f);break;case d.BarometricPressure.UUID_SERVICE:g.BarometricPressure.init(f);break;case d.Gyroscope.UUID_SERVICE:g.Gyroscope.init(f);break;case d.SimpleKey.UUID_SERVICE:g.SimpleKey.init(f)}}g.log("Initialized"),a!==b&&a.call(g)},f=function(a,d){g.log(a+" error: "+d),c!==b&&c.call(g,d)},evothings.ble.services(g.device,function(b){b.characteristics=[],0===b.characteristicCount&&(h.push(b),h.length==b.serviceCount&&e(h,a)),evothings.ble.characteristics(g.device,b.handle,function(c){c.descriptors=[],0===c.descriptorCount&&(b.characteristics.push(c),b.characteristics.length==b.characteristicCount&&h.push(b),h.length==b.serviceCount&&e(h,a)),evothings.ble.descriptors(g.device,c.handle,function(d){c.descriptors.push(d),c.descriptors.length==c.descriptorCount&&b.characteristics.push(c),b.characteristics.length==b.characteristicCount&&h.push(b),h.length==b.serviceCount&&e(h,a)},function(a){f("Descriptor",a)})},function(a){f("Characteristic",a)})},function(a){f("Service",a)})},d.prototype.close=function(){evothings.ble.close(this.device)},d.SensorBase=function(a,b,c,d){this.identifier="Sensor",this.sensorTag=a,this.UUID_DATA=b,this.UUID_CONF=c,this.UUID_PERIOD=d,this.enabled=!1,this._handles={config:null,period:null,data:null,notification:null},this._listeners=[]},d.SensorBase.prototype.init=function(a){for(var b in a.characteristics){var d=a.characteristics[b];switch(d.uuid){case this.UUID_CONF:this._handles.config=d.handle;break;case this.UUID_PERIOD:this._handles.period=d.handle;break;case this.UUID_DATA:this._handles.data=d.handle;for(var e in d.descriptors){var f=d.descriptors[e];f.uuid==c&&(this._handles.notification=f.handle)}}}},d.SensorBase.prototype.log=function(a){this.sensorTag.log(this.identifier+": "+a)},d.SensorBase.prototype.enable=function(a){var b=1,c=this;evothings.ble.writeCharacteristic(c.sensorTag.device,c._handles.config,new Uint8Array([a||b]),function(){c.enabled=!0},function(a){c.log("enable error: "+a)})},d.SensorBase.prototype.disable=function(){var a=0,b=this;evothings.ble.writeCharacteristic(b.sensorTag.device,b._handles.config,new Uint8Array([a]),function(){b.enabled=!1},function(a){b.log("disable error: "+a)})},d.SensorBase.prototype.enableNotifications=function(){var a=[1,0],b=this;evothings.ble.writeDescriptor(b.sensorTag.device,b._handles.notification,new Uint8Array(a),function(){b.log("Notifications enabled")},function(a){b.log("enableNotifications write error: "+a)}),evothings.ble.enableNotification(b.sensorTag.device,b._handles.data,function(){b.onDataNotify.apply(b,arguments)},function(a){b.log("enableNotifications subscribe error: "+a)})},d.SensorBase.prototype.disableNotification=function(){var a=[0,0],b=this;evothings.ble.writeDescriptor(b.sensorTag.device,b._handles.notification,new Uint8Array(a),function(){b.log("Notifications disabled")},function(a){b.log("disableNotification write error: "+a)}),evothings.ble.disableNotification(b.sensorTag.device,b._handles.data,function(){},function(a){b.log("disableNotification unsubscribe error: "+a)})},d.SensorBase.prototype.addListener=function(a){return this._listeners.push(a),this._listeners.length-1},d.SensorBase.prototype.removeListener=function(a){this._listeners.splice(a,1)},d.SensorBase.prototype.onDataNotify=function(){for(var a in this._listeners){var b=this._listeners[a];b.apply(this,arguments)}},d.IRTemperature=function(a){var b="f000aa01-0451-4000-b000-000000000000",c="f000aa02-0451-4000-b000-000000000000",e="f000aa03-0451-4000-b000-000000000000";d.SensorBase.prototype.constructor.call(this,a,b,c,e),this.identifier="IRTemperature",this.scale=d.IRTemperature.Scale.Celcius},d.IRTemperature.UUID_SERVICE="f000aa00-0451-4000-b000-000000000000",d.IRTemperature.prototype=new d.SensorBase,d.IRTemperature.prototype.constructor=d.IRTemperature,d.IRTemperature.prototype.scaleTemperature=function(a,b){switch(b=b||this.scale){case d.IRTemperature.Scale.Farenheit:a=1.8*a+32}return a},d.IRTemperature.prototype.calculateAmbientTemperature=function(a,b){var c=new Int16Array(a),d=c[1]/128;return this.scaleTemperature(d,b)},d.IRTemperature.prototype.calculateTargetTemperature=function(a,b){var c=this.calculateAmbientTemperature(a,d.IRTemperature.Scale.Celcius),e=new Int16Array(a),f=1.5625e-7*e[0],g=c+273.15,h=5.593e-14,i=.00175,j=-1678e-8,k=-294e-7,l=-5.7e-7,m=4.63e-9,n=13.4,o=298.15,p=h*(1+i*(g-o)+j*Math.Pow(g-o,2)),q=k+l*(g-o)+m*Math.Pow(g-o,2),r=f-q+n*Math.Pow(f-q,2),s=Math.Pow(Math.Pow(g,4)+r/p,.25)-273.15;return this.scaleTemperature(s,b)},d.IRTemperature.Scale={Celcius:0,Farenheit:1},d.Accelerometer=function(a){var b="f000aa11-0451-4000-b000-000000000000",c="f000aa12-0451-4000-b000-000000000000",e="f000aa13-0451-4000-b000-000000000000";d.SensorBase.prototype.constructor.call(this,a,b,c,e),this.identifier="Accelerometer"},d.Accelerometer.UUID_SERVICE="f000aa10-0451-4000-b000-000000000000",d.Accelerometer.prototype=new d.SensorBase,d.Accelerometer.prototype.constructor=d.Accelerometer,d.Accelerometer.prototype.setPeriod=function(a){var b=Math.round(a/10),c=this;evothings.ble.writeCharacteristic(c.sensorTag.device,c._handles.period,new Uint8Array([b]),function(){c.log("Period set to "+a+"ms")},function(a){c.log("setPeriod error: "+a)})},d.Accelerometer.prototype.calculateAcceleration=function(a,b){var c,d=64;c=function(a){var c=b||1,e=a*c/d;return Math.round(100*e)/100};var e=new Int8Array(a);return{x:c(e[0]),y:c(e[1]),z:c(e[2])}},d.Humidity=function(a){var b="f000aa21-0451-4000-b000-000000000000",c="f000aa22-0451-4000-b000-000000000000",e="f000aa23-0451-4000-b000-000000000000";d.SensorBase.prototype.constructor.call(this,a,b,c,e),this.identifier="Humidity"},d.Humidity.UUID_SERVICE="f000aa20-0451-4000-b000-000000000000",d.Humidity.prototype=new d.SensorBase,d.Humidity.prototype.constructor=d.Humidity,d.Humidity.prototype.calculateHumidity=function(a){var b,c=new Uint16Array(a);return b=c[1]-c[1]%4,-6+125*(b/65535)},d.Magnetometer=function(a){var b="f000aa31-0451-4000-b000-000000000000",c="f000aa32-0451-4000-b000-000000000000",e="f000aa33-0451-4000-b000-000000000000";d.SensorBase.prototype.constructor.call(this,a,b,c,e),this.identifier="Magnetometer"},d.Magnetometer.UUID_SERVICE="f000aa30-0451-4000-b000-000000000000",d.Magnetometer.prototype=new d.SensorBase,d.Magnetometer.prototype.constructor=d.Magnetometer,d.Magnetometer.prototype.setPeriod=d.Accelerometer.prototype.setPeriod,d.Magnetometer.prototype.calculateCoordinates=function(a){var b,c=new Int16Array(a);return b=function(a){return a*(2e3/65536)},{x:b(c[0]),y:b(c[1]),z:b(c[2])}},d.BarometricPressure=function(a){var b="f000aa41-0451-4000-b000-000000000000",c="f000aa42-0451-4000-b000-000000000000",e="f000aa44-0451-4000-b000-000000000000";d.SensorBase.prototype.constructor.call(this,a,b,c,e),this.UUID_CALIBRATION="f000aa43-0451-4000-b000-000000000000",this.identifier="BarametricPressure",this.calibration=[0,0,0,0,0,0,0,0],this._handles.calibration=null},d.BarometricPressure.UUID_SERVICE="f000aa40-0451-4000-b000-000000000000",d.BarometricPressure.prototype=new d.SensorBase,d.BarometricPressure.prototype.constructor=d.BarometricPressure,d.BarometricPressure.prototype.init=function(a){for(var b in a.characteristics){var c=a.characteristics[b];switch(c.uuid){case this.UUID_CALIBRATION:this._handles.calibration=c.uuid}}d.SensorBase.prototype.init.call(this,a)},d.BarometricPressure.prototype.readCalibration=function(a,c){var d,e=this,f=2;d=function(a,d){e.log(a+" error: "+d),c!==b&&c.call(e,d)},evothings.ble.writeCharacteristic(e.sensorTag.device,e._handles.config,new Uint8Array([f]),function(){evothings.ble.readCharacteristic(e.sensorTag.device,e._handles.calibration,function(c){e.calibration=new Uint16Array(c),a!==b&&a.call(e,e.calibration)},function(a){d("readCalibration read",a)})},function(a){d("readCalibration write",a)})},d.BarometricPressure.prototype.enable=function(){this.readCalibration(SensorBase.prototype.enable)},d.BarometricPressure.prototype.calculatePressure=function(a){var b=new Int16Array(a),c=b[0],d=b[1],e=(100*(this.calibration[0]*c/Math.Pow(2,8)+this.calibration[1]*Math.Pow(2,6))/Math.Pow(2,16),this.calibration[2]+this.calibration[3]*c/Math.Pow(2,17)+this.calibration[4]*c/Math.Pow(2,15)*c/Math.Pow(2,19)),f=this.calibration[5]*Math.Pow(2,14)+this.calibration[6]*c/Math.Pow(2,3)+this.calibration[7]*c/Math.Pow(2,15)*c/Math.Pow(2,4);return(e*d+f)/Math.Pow(2,14)},d.Gyroscope=function(a){var b="f000aa51-0451-4000-b000-000000000000",c="f000aa52-0451-4000-b000-000000000000",e="f000aa53-0451-4000-b000-000000000000";d.SensorBase.prototype.constructor.call(this,a,b,c,e),this.Axis=d.Gyroscope.Axis.XYZ,this.identifier="Gyroscope"},d.Gyroscope.UUID_SERVICE="f000aa50-0451-4000-b000-000000000000",d.Gyroscope.Axis={X:1,Y:2,XY:3,Z:4,XZ:5,YZ:6,XYZ:7},d.Gyroscope.prototype=new d.SensorBase,d.Gyroscope.prototype.constructor=d.Gyroscope,d.Gyroscope.prototype.enable=function(){d.SensorBase.prototype.enable.call(this,this.Axis)},d.Gyroscope.prototype.calculateAxisValue=function(a){var b,c=new Int16Array(a);return b=function(a){var b=a*(500/65536);return Math.round(100*b)/100},{y:b(c[0]),x:b(c[1]),z:b(c[2])}},d.SimpleKey=function(){var a="0000ffe1-0000-1000-8000-00805f9b34fb";d.SensorBase.prototype.constructor.call(this,a),this.identifier="SimpleKey"},d.SimpleKey.UUID_SERVICE="0000ffe0-0000-1000-8000-00805f9b34fb",d.SimpleKey.Keys={RIGHT:1,LEFT:2,CENTER:4},d.SimpleKey.prototype=new d.SensorBase,d.SimpleKey.prototype.constructor=d.SimpleKey,delete d.SimpleKey.prototype.enable,delete d.SimpleKey.prototype.disable,a.SensorTag=d}(window);